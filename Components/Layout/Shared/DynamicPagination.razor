<div class="flex flex-col justify-center items-center mt-6 mb-6">

    <nav class="isolate inline-flex -space-x-px rounded-md shadow-sm" aria-label="Pagination">

        <button type="button"
                class="relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0"
                @onclick="() => ChangePage(Selected - 1)">
            <span class="sr-only">Previous</span>
            <Icon Name="IconName.AngleLeft" />
        </button>

        @if(Count<=7)
        {
            for(int i=1; i<=Count; i++)
            {
                int pageNumber = i;
                if(i == Selected)
                {
                    <button type="button"
                            class="relative z-10 inline-flex items-center bg-blue-600 px-4 py-2 text-sm font-semibold text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600"
                            >
                        @i
                    </button>
                }
                else
                {
                    <button type="button"
                            class="relative inline-flex items-center px-4 py-2 text-sm font-medium text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0"
                            @onclick="() => ChangePage(pageNumber)">
                        @i
                    </button>
                }
            }
        }
        else
        {

            // 1. NÚT TRANG ĐẦU
            if (Selected == 1)
            {
                <button type="button" class="relative z-10 inline-flex items-center bg-blue-600 px-4 py-2 text-sm font-semibold text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600">
                    1
                </button>
            }
            else
            {
                <button type="button" class="relative inline-flex items-center px-4 py-2 text-sm font-medium text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0"
                        @onclick="() => ChangePage(1)">
                    1
                </button>
            }

            // 2. Tính toán khoảng giữa
            int startPage, endPage;
            if (Selected <= 4)
            {
                startPage = 2;
                endPage = 5;
            }
            else if (Selected >= Count - 3)
            {
                startPage = Count - 4;
                endPage = Count - 1;
            }
            else
            {
                startPage = Selected - 1;
                endPage = Selected + 1;
            }

            // 3. Dấu ... trái
            if (startPage > 2)
            {
                <span class="relative inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 ring-1 ring-inset ring-gray-300 focus:outline-offset-0">...</span>
            }

            // 4. Vòng lặp giữa
            for (int i = startPage; i <= endPage; i++)
            {
                int pageNumber = i;
                if (i == Selected)
                {
                    <button type="button" class="relative z-10 inline-flex items-center bg-blue-600 px-4 py-2 text-sm font-semibold text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600">
                        @i
                    </button>
                }
                else
                {
                    <button type="button" class="relative inline-flex items-center px-4 py-2 text-sm font-medium text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0"
                            @onclick="() => ChangePage(pageNumber)">
                        @i
                    </button>
                }
            }

            // 5. Dấu ... phải
            if (endPage < Count - 1)
            {
                <span class="relative inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 ring-1 ring-inset ring-gray-300 focus:outline-offset-0">...</span>
            }

            // 6. NÚT TRANG CUỐI
            if (Selected == Count)
            {
                <button type="button" class="relative z-10 inline-flex items-center bg-blue-600 px-4 py-2 text-sm font-semibold text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600">
                    @Count
                </button>
            }
            else
            {
                <button type="button" class="relative inline-flex items-center px-4 py-2 text-sm font-medium text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0"
                        @onclick="() => ChangePage(Count)">
                    @Count
                </button>
            }
        }

        <button type="button"
                class="relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0"
                @onclick="() => ChangePage(Selected + 1)">
            <span class="sr-only">Next</span>
            <Icon Name="IconName.AngleRight" />
        </button>

    </nav>

    <div class="flex items-center gap-2 mt-4">
        <span class="text-sm text-gray-700">Go to page:</span>
        <input type="number" @bind-value="pageToGo" class="w-10 p-2 border-gray-300 text-xs rounded-lg no-spinner"/>
        <button type="button"
                class="px-4 py-2 text-xs bg-blue-500 rounded-lg text-white"
                @onclick="() => ChangePage(pageToGo)">Go</button>
    </div>
    
</div>

@code {
    [Parameter] public int Count {get; set;}
    [Parameter] public int Selected { get; set; }
    [Parameter] public EventCallback<int> OnPageChanged { get; set; }
    public int pageToGo;

    private async Task ChangePage(int page)
    {
        if (page < 1 || page > Count || page == Selected)
        {
            return;
        }
        await OnPageChanged.InvokeAsync(page);
    }

}